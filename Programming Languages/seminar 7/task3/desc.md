нужно ограничить fill размером буфера  
также добавить проверку на переполнение ```read_total>=buf_size```
![img.png](img.png)