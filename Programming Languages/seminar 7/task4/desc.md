1) нельзя хранить флаг состояния "вплотную" после буфера, чтобы него нельзя было затереть, при переполнении буфера
2) необходимо устанавливать ограничение на размер вводимых данных